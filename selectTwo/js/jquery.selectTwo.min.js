(function(c){c.fn.select2.amd.define("CustomResults",["jquery","select2/utils","select2/results"],function(h,g,f){f.prototype.option=function(n){if(n.hidden){return null}var m,o=false;if(n.children){m=h('.select2-results__option[aria-label="'+n.text+'"]')[0];if(h(m).length===0){m=document.createElement("li");m.className="select2-results__option"}else{o=true}}else{m=document.createElement("li");m.className="select2-results__option"}var v={role:"treeitem","aria-selected":"false"};if(n.customClass){h(m).addClass("custom-class")}if(n.disabled){delete v["aria-selected"];v["aria-disabled"]="true"}if(n.id==null){delete v["aria-selected"]}if(n._resultId!=null){m.id=n._resultId}if(n.title){m.title=n.title}if(n.children){v.role="group";v["aria-label"]=n.text;delete v["aria-selected"]}for(var p in v){var l=v[p];m.setAttribute(p,l)}if(n.children){var i=h(m);var t=document.createElement("strong");t.className="select2-results__group";var s=h(t);this.template(n,t);var u=[];for(var r=0;r<n.children.length;r++){var k=n.children[r];var j=this.option(k);u.push(j)}var q;if(o){q=i.find(".select2-results__options--nested")}else{q=h("<ul></ul>",{"class":"select2-results__options select2-results__options--nested"})}q.append(u);if(!o){i.append(t);i.append(q)}}else{this.template(n,m)}h.data(m,"data",n);return m}});c.fn.select2.amd.define("CustomSelectAdapter",["select2/data/select"],function(f){f.prototype.query=function(h,g){var j=[],i=this;this.$element.children().each(function(){var k=c(this);if(k.is("option")||k.is("optgroup")){var m=i.item(k);var l=i.matches(h,m,j);null!==l.data&&j.push(l.data)}});g({results:j})};f.prototype.matches=function(i,h,g){return this.options.get("matcher")(i,h,g)};f.prototype.current=function(i){var h=[];var g=this;this.$element.find("option").each(function(){var k=c(this);if(this.selected){var j=g.item(k);h.push(j)}});i(h)}});c.fn.select2.amd.define("CustomMultipleSelection",["jquery","select2/selection/base","select2/utils","select2/selection/multiple"],function(i,f,h,g){g.prototype.update=function(n){this.clear();if(n.length===0){return}var k=[];for(var o=0;o<n.length;o++){var j=n[o];var m=this.selectionContainer();var l=this.display(j,m);m.append(l);m.attr("title",j.title||j.text);m.attr("data-id",j.id||"");h.StoreData(m[0],"data",j);k.push(m)}var p=this.$selection.find(".select2-selection__rendered");h.appendMany(p,k)}});function d(g){var f=g.data("preserved-order")||[],h=g.next(".select2-container"),j=h.find("li.select2-selection__choice"),i=j.last().next();if(typeof f!=="object"){f=[f]}f.forEach(function(l){var k=j.filter(function(n,m){return c(m).attr("data-id")===l});i.before(k)})}var a=100;c.fn.selectTwo=function(i,h){var l={useSelect2:false,data:[],allowClear:true,multiple:false,width:"153px",placeholder:"请选择",id:"id",matchField:["text"],resultFormat:"",selectedFormat:"",notMatched:false,labelPreventDefault:true,maxItemShow:a,maxSelectedItem:-1,minInputLength:-1,minInputText:"请至少输入%min%个字",noResultText:"没有匹配结果",searchingText:"查询中...",loadingMoreText:"加载中...",maxSelectedText:"只能选择%max%项",ajax:null,group:false,groupTitleShow:true,groupEmptyTitleShow:true,change:function(m,o,n){},beforeBinding:function(m){return m}};var g={delay:250,url:"url",data:function(m){return{k:m.term}},success:function(m,n){m=typeof m==="string"?JSON.parse(m):m;return{data:m}},processResults:function(m,n){return{results:m}}};var j={updateData:function(m,n){m.empty();m.html("<option />");n=e(n,m.data("select2").options.options);var o=m.data("select2").dataAdapter;o.addOptions(o.convertToOptions(n))},updateValue:function(m,n){m.val(n).data("preserved-order",n);if(typeof n==="object"&&n.forEach){n.forEach(function(p){var o=m.find("optgroup");if(o.length){var q=o.children("[value="+p+"]");q.detach();o.append(q)}else{var q=m.children("[value="+p+"]");q.detach();m.append(q)}})}m.trigger("change",true);d(m)},destroy:function(m,n){m.select2("destroy");m.off("select2:close select2:open select2:select select2:unselect change");n&&m.empty()},close:function(m,n){m.select2("close")},open:function(m,n){m.select2("open")}};if(typeof i==="string"){if(j[i]){this.each(function(){var m=c(this);if(!m.data("select2")){return}j[i](m,h)})}return this}else{h=i}if(h.useSelect2){this.select2(h);return this}this.css("width",h.width||l.width);if(h.ajax){var f=c.extend(true,{},l);f.ajax=g;var k=c.extend(true,{},f,h)}else{var k=c.extend(true,{},l,h)}k.minimumInputLength=k.minInputLength;k.maximumSelectionLength=k.maxSelectedItem;k.tags=k.notMatched;k.language={inputTooShort:function(m){if(m.minimum===1){return"请输入"}return k.minInputText.replace("%min%",m.minimum)},noResults:function(){return k.noResultText},searching:function(){return k.searchingText},loadingMore:function(){return k.loadingMoreText},maximumSelected:function(m){return k.maxSelectedText.replace("%max%",m.maximum)}};if(k.ajax){k.ajax.processResults=function(m,p){var o=k.ajax.success(m,p);var n=o.data;if(!k.group){k.data=n}else{k.group.forEach(function(q){q.data=n[q.groupKey]||[]})}k.data=e(k.group||k.data,k);o.results=k.data;return o}}else{k.data=e(k.group||k.data,k)}this.each(function(){b(c(this),k)});return this};function e(h,f){if(!f.group){f.idField=f.id;f.textField=f.matchField;h=c.map(h,function(i){i=f.beforeBinding(i);i.id=i.id||i[f.idField];var j=[];f.textField.forEach(function(k){i[k]&&j.push(i[k])});i.text=i.text||j.join("");return i});return h}else{var g=[];h.forEach(function(i){i.idField=i.id;i.textField=i.matchField;i.maxItemShow=i.maxItemShow||a;i.data=c.map(i.data,function(j){j=f.beforeBinding(j);j.matchField=i.matchField;j.resultFormat=i.resultFormat;i.selectedFormat=i.selectedFormat;j.id=j.id||j[i.idField];var k=[];i.textField.forEach(function(l){j[l]&&k.push(j[l])});j.text=j.text||k.join("");return j});if(i.data.length||f.groupEmptyTitleShow){g.push({id:i.id,text:i.title,children:i.data,maxItemShow:i.maxItemShow})}});return g}}function b(g,f){if(f.multiple){f.allowClear=false;g.find('option[value=""]').remove()}else{!g.find('option[value=""]').length&&g.prepend('<option value="" />')}var i=c.extend(true,{Results:c.fn.select2.amd.require("CustomResults"),SelectAdapter:c.fn.select2.amd.require("CustomSelectAdapter"),MultipleSelection:c.fn.select2.amd.require("CustomMultipleSelection"),matcher:function(p,o,k){if(c.trim(p.term)===""&&o.text){return{data:o}}if(typeof o.text==="undefined"||o.text===""||o.id===""||(i.group&&typeof o.children==="undefined")){return{data:null}}var n=p.term.toLowerCase();if(f.group){var m=[];o.children.forEach(function(q){q.matchField.forEach(function(r){if(q[r]&&q[r].toLowerCase().indexOf(n)!==-1){m.push(q);return false}})});if(m.length){var l=c.extend(true,{},o);l.children=m;return{data:l}}return{data:null}}var j=false;i.matchField.forEach(function(q){if(o[q]&&o[q].toLowerCase().indexOf(n)!==-1){j=true;return false}});if(j){return{data:c.extend(true,{},o)}}else{return{data:null}}},sorter:function(q){if(i.group){var p=c.extend(true,[],q);var o=c(".my-select").val()||[];o=typeof o==="string"?[o]:o;p.forEach(function(v){if(v.children){var u=v.maxItemShow;var w=v.children.slice(0,u);var r=false;for(var t=u;t<v.children.length;++t){for(var s=0;s<o.length;++s){if(v.children[t][f.idField]===o[s]){r=true;w.push(v.children[t])}}}r&&w.splice(u-o.length,o.length);v.children=w}});return p}var n=i.maxItemShow;var p=q.slice(0,n);var k=false;var o=g.val()||[];o=typeof o==="string"?[o]:o;for(var m=n;m<q.length;++m){for(var l=0;l<o.length;++l){if(q[m][f.idField]===o[l]){k=true;p.push(q[m])}}}k&&p.splice(n-o.length,o.length);return p},templateResult:function(m){var l=i.group?m.resultFormat:i.resultFormat;var n=l;if(!n||m.loading){return m.text}for(var j in m){if(m.hasOwnProperty(j)){var k=new RegExp("%"+j+"%","gi");n=n.replace(k,m[j])}}if(n===l&&i.tags){return m.text}return n},templateSelection:function(m){var l=i.group?m.resultFormat:i.resultFormat;var n=i.group?m.selectedFormat:i.selectedFormat;var o=n||l;if(!o||m.text===i.placeholder){return m.text}for(var j in m){if(m.hasOwnProperty(j)){var k=new RegExp("%"+j+"%","gi");o=o.replace(k,m[j])}}if(o===(n||l)&&i.tags){return m.text}return o}},f);g.select2(i).on("select2:close",function(k){var j=c(this).data("select2");j.$selection.removeClass("no-top no-bottom");setTimeout(function(){j.$selection.find(".select2-search__field").focus()},0)}).on("select2:open",function(k){var j=c(this).data("select2");if(j.$dropdown.find(".select2-dropdown--above").length){j.$dropdown.addClass("no-margin-top");j.$selection.addClass("no-top").removeClass("no-bottom")}else{j.$dropdown.removeClass("no-margin-top");j.$selection.addClass("no-bottom").removeClass("no-top")}}).on("select2:select",function(l){if(i.ajax){var k=c(this);i.change(k,l.params.data,k.val())}else{if(this.value){var m=l.params.data.id;var j=c(l.target).children("[value="+m+"]");j.detach();c(l.target).append(j).trigger("change",true)}}}).on("select2:unselect",function(l){if(i.ajax){var k=c(this);i.change(k,l.params.data,k.val())}else{if(this.value){var m=l.params.data.id;var j=c(l.target).children("[value="+m+"]");j.detach();c(l.target).append(j).trigger("change",true)}}}).on("change",function(p,l){if(i.ajax||(this.value&&!l)){return}var j=c(this).data("select2");j.$container.find(".select2-selection__rendered, .select2-selection__choice").attr("title","");var o=c(this),n=[],k={},m=[].concat(o.val());if(i.group){i.group.forEach(function(r){var q=[];r.data.forEach(function(s){if(m.indexOf(s.id)!==-1){q[m.indexOf(s.id)]=s;if(!i.multiple){return false}}});if(i.multiple){k[r.id]=q}else{k[r.id]=q[0]}});i.change(o,k,i.multiple?m:m[0]);return}i.data.forEach(function(q){if(m.indexOf(q.id)!==-1){n[m.indexOf(q.id)]=q;if(!i.multiple){return false}}});if(i.multiple){i.change(o,n,m)}else{i.change(o,n[0],m[0])}});if(i.labelPreventDefault){g.closest("label").on("click",function(j){j.preventDefault()})}var h=g.data("select2");h.$container.find(".select2-selection__rendered, .select2-selection__choice").attr("title","");if(i.group&&!i.groupTitleShow){h.$dropdown.addClass("select2-results__groupHide")}h.$selection.css("width",i.width)}})(jQuery);
