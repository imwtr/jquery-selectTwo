(function(c){c.fn.select2.amd.define("CustomResults",["jquery","select2/utils","select2/results"],function(g,f,e){e.prototype.option=function(m){var l,n=false;if(m.children){l=g('.select2-results__option[aria-label="'+m.text+'"]')[0];if(g(l).length===0){l=document.createElement("li");l.className="select2-results__option"}else{n=true}}else{l=document.createElement("li");l.className="select2-results__option"}var u={role:"treeitem","aria-selected":"false"};if(m.disabled){delete u["aria-selected"];u["aria-disabled"]="true"}if(m.id==null){delete u["aria-selected"]}if(m._resultId!=null){l.id=m._resultId}if(m.title){l.title=m.title}if(m.children){u.role="group";u["aria-label"]=m.text;delete u["aria-selected"]}for(var o in u){var k=u[o];l.setAttribute(o,k)}if(m.children){var h=g(l);var s=document.createElement("strong");s.className="select2-results__group";var r=g(s);this.template(m,s);var t=[];for(var q=0;q<m.children.length;q++){var j=m.children[q];var i=this.option(j);t.push(i)}var p;if(n){p=h.find(".select2-results__options--nested")}else{p=g("<ul></ul>",{"class":"select2-results__options select2-results__options--nested"})}p.append(t);if(!n){h.append(s);h.append(p)}}else{this.template(m,l)}g.data(l,"data",m);return l}});c.fn.select2.amd.define("CustomSelectAdapter",["select2/data/select"],function(e){e.prototype.query=function(g,f){var i=[],h=this;this.$element.children().each(function(){var j=c(this);if(j.is("option")||j.is("optgroup")){var l=h.item(j);var k=h.matches(g,l,i);null!==k.data&&i.push(k.data)}});f({results:i})};e.prototype.matches=function(h,g,f){return this.options.get("matcher")(h,g,f)};e.prototype.current=function(h){var g=[];var f=this;this.$element.find("option").each(function(){var j=c(this);if(this.selected){var i=f.item(j);g.push(i)}});h(g)}});var a=100;c.fn.selectTwo=function(h,g){var k={useSelect2:false,data:[],allowClear:true,multiple:false,width:"153px",placeholder:"请选择",id:"id",matchField:["text"],resultFormat:"",selectedFormat:"",notMatched:false,maxItemShow:a,maxSelectedItem:-1,minInputLength:-1,minInputText:"请至少输入%min%个字",noResultText:"没有匹配结果",searchingText:"查询中...",loadingMoreText:"加载中...",maxSelectedText:"只能选择%max%项",ajax:null,group:false,groupTitleShow:true,groupEmptyTitleShow:true,change:function(l,n,m){},beforeBinding:function(l){return l}};var f={delay:250,url:"url",data:function(l){return{k:l.term}},success:function(l,m){l=typeof l==="string"?JSON.parse(l):l;return{data:l}},processResults:function(l,m){return{results:l}}};var i={updateData:function(l,m){l.empty();l.html("<option />");m=d(m,l.data("select2").options.options);var n=l.data("select2").dataAdapter;n.addOptions(n.convertToOptions(m))},updateValue:function(l,m){l.val(m).trigger("change")},destroy:function(l,m){l.select2("destroy");l.off("select2:close select2:open select2:select select2:unselect change");m&&l.empty()},};if(typeof h==="string"){if(i[h]){this.each(function(){var l=c(this);if(!l.data("select2")){return}i[h](l,g)})}return}else{g=h}if(g.useSelect2){this.select2(g);return}if(g.ajax){var e=c.extend(true,{},k);e.ajax=f;var j=c.extend(true,{},e,g)}else{var j=c.extend(true,{},k,g)}j.minimumInputLength=j.minInputLength;j.maximumSelectionLength=j.maxSelectedItem;j.tags=j.notMatched;j.language={inputTooShort:function(l){if(l.minimum===1){return"请输入"}return j.minInputText.replace("%min%",l.minimum)},noResults:function(){return j.noResultText},searching:function(){return j.searchingText},loadingMore:function(){return j.loadingMoreText},maximumSelected:function(l){return j.maxSelectedText.replace("%max%",l.maximum)}};if(j.ajax){j.ajax.processResults=function(l,o){var n=j.ajax.success(l,o);var m=n.data;if(!j.group){j.data=m}else{j.group.forEach(function(p){p.data=m[p.groupKey]||[]})}j.data=d(j.group||j.data,j);n.results=j.data;return n}}else{j.data=d(j.group||j.data,j)}this.each(function(){b(c(this),j)})};function d(g,e){if(!e.group){e.idField=e.id;e.textField=e.matchField;g=c.map(g,function(h){h=e.beforeBinding(h);h.id=h.id||h[e.idField];var i=[];e.textField.forEach(function(j){h[j]&&i.push(h[j])});h.text=h.text||i.join("");return h});return g}else{var f=[];g.forEach(function(h){h.idField=h.id;h.textField=h.matchField;h.maxItemShow=h.maxItemShow||a;h.data=c.map(h.data,function(i){i=e.beforeBinding(i);i.matchField=h.matchField;i.resultFormat=h.resultFormat;h.selectedFormat=h.selectedFormat;i.id=i.id||i[h.idField];var j=[];h.textField.forEach(function(k){i[k]&&j.push(i[k])});i.text=i.text||j.join("");return i});if(h.data.length||e.groupEmptyTitleShow){f.push({id:h.id,text:h.title,children:h.data,maxItemShow:h.maxItemShow})}});return f}}function b(f,e){if(e.multiple){e.allowClear=false;f.find('option[value=""]').remove()}else{!f.find('option[value=""]').length&&f.prepend('<option value="" />')}var h=c.extend(true,{Results:c.fn.select2.amd.require("CustomResults"),SelectAdapter:c.fn.select2.amd.require("CustomSelectAdapter"),matcher:function(o,n,j){if(c.trim(o.term)===""&&n.text){return{data:n}}if(typeof n.text==="undefined"||n.text===""||n.id===""||(h.group&&typeof n.children==="undefined")){return{data:null}}var m=o.term.toLowerCase();if(e.group){var l=[];n.children.forEach(function(p){p.matchField.forEach(function(q){if(p[q]&&p[q].toLowerCase().indexOf(m)!==-1){l.push(p);return false}})});if(l.length){var k=c.extend(true,{},n);k.children=l;return{data:k}}return{data:null}}var i=false;h.matchField.forEach(function(p){if(n[p]&&n[p].toLowerCase().indexOf(m)!==-1){i=true;return false}});if(i){return{data:c.extend(true,{},n)}}else{return{data:null}}},sorter:function(q){if(h.group){var p=c.extend(true,[],q);var o=c(".my-select").val()||[];o=typeof o==="string"?[o]:o;p.forEach(function(v){if(v.children){var u=v.maxItemShow;var w=v.children.slice(0,u);var r=false;for(var t=u;t<v.children.length;++t){for(var s=0;s<o.length;++s){if(v.children[t][e.idField]===o[s]){r=true;w.push(v.children[t])}}}r&&w.splice(u-o.length,o.length);v.children=w}});return p}var n=h.maxItemShow;var p=q.slice(0,n);var k=false;var o=f.val()||[];o=typeof o==="string"?[o]:o;for(var m=n;m<q.length;++m){for(var l=0;l<o.length;++l){if(q[m][e.idField]===o[l]){k=true;p.push(q[m])}}}k&&p.splice(n-o.length,o.length);return p},templateResult:function(m){var l=h.group?m.resultFormat:h.resultFormat;var n=l;if(!n||m.loading){return m.text}for(var j in m){if(m.hasOwnProperty(j)){var k=new RegExp("%"+j+"%","gi");n=n.replace(k,m[j])}}if(n===l&&h.tags){return m.text}return n},templateSelection:function(m){var l=h.group?m.resultFormat:h.resultFormat;var n=h.group?m.selectedFormat:h.selectedFormat;var o=n||l;if(!o||m.text===h.placeholder){return m.text}for(var j in m){if(m.hasOwnProperty(j)){var k=new RegExp("%"+j+"%","gi");o=o.replace(k,m[j])}}if(o===(n||l)&&h.tags){return m.text}return o}},e);f.select2(h).on("select2:close",function(j){var i=c(this).data("select2");i.$selection.removeClass("no-top no-bottom");setTimeout(function(){i.$selection.find(".select2-search__field").focus()},0)}).on("select2:open",function(j){var i=c(this).data("select2");if(i.$dropdown.find(".select2-dropdown--above").length){i.$dropdown.addClass("no-margin-top");i.$selection.addClass("no-top").removeClass("no-bottom")}else{i.$dropdown.removeClass("no-margin-top");i.$selection.addClass("no-bottom").removeClass("no-top")}}).on("select2:select",function(j){if(h.ajax){var i=c(this);h.change(i,j.params.data,i.val())}}).on("select2:unselect",function(j){if(h.ajax){var i=c(this);h.change(i,j.params.data,i.val())}}).on("change",function(){if(h.ajax){return}var i=c(this).data("select2");i.$container.find(".select2-selection__rendered, .select2-selection__choice").attr("title","");var m=c(this),l=[],j={},k=[].concat(m.val());if(h.group){h.group.forEach(function(o){var n=[];o.data.forEach(function(p){if(k.indexOf(p.id)!==-1){n.push(p);if(!h.multiple){return false}}});if(h.multiple){j[o.id]=n}else{j[o.id]=n[0]}});h.change(m,j,h.multiple?k:k[0]);return}h.data.forEach(function(n){if(k.indexOf(n.id)!==-1){l.push(n);if(!h.multiple){return false}}});if(h.multiple){h.change(m,l,k)}else{h.change(m,l[0],k[0])}});var g=f.data("select2");g.$container.find(".select2-selection__rendered, .select2-selection__choice").attr("title","");if(h.group&&!h.groupTitleShow){g.$dropdown.addClass("select2-results__groupHide")}g.$selection.css("width",h.width)}})(jQuery);
