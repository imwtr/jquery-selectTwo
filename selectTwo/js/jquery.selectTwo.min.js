(function(d){d.fn.select2.amd.define("CustomResults",["jquery","select2/utils","select2/results"],function(i,h,g){g.prototype.option=function(o){if(o.hidden){return null}var p,m=false;if(o.children){p=i('.select2-results__option[aria-label="'+o.text+'"]')[0];if(i(p).length===0){p=document.createElement("li");p.className="select2-results__option"}else{m=true}}else{p=document.createElement("li");p.className="select2-results__option"}var w={"role":"treeitem","aria-selected":"false"};if(o.customClass){i(p).addClass("custom-class")}if(o.disabled){delete w["aria-selected"];w["aria-disabled"]="true"}if(o.id==null){delete w["aria-selected"]}if(o._resultId!=null){p.id=o._resultId}if(o.title){p.title=o.title}if(o.children){w.role="group";w["aria-label"]=o.text;delete w["aria-selected"]}for(var q in w){var n=w[q];p.setAttribute(q,n)}if(o.children){var j=i(p);var u=document.createElement("strong");u.className="select2-results__group";var t=i(u);this.template(o,u);var v=[];for(var s=0;s<o.children.length;s++){var l=o.children[s];var k=this.option(l);v.push(k)}var r;if(m){r=j.find(".select2-results__options--nested")}else{r=i("<ul></ul>",{"class":"select2-results__options select2-results__options--nested"})}r.append(v);if(!m){j.append(u);j.append(r)}}else{this.template(o,p)}i.data(p,"data",o);return p}});d.fn.select2.amd.define("CustomSelectAdapter",["select2/data/select"],function(g){g.prototype.query=function(i,h){var k=[],j=this;this.$element.children().each(function(){var l=d(this);if(l.is("option")||l.is("optgroup")){var n=j.item(l);var m=j.matches(i,n,k);null!==m.data&&k.push(m.data)}});h({results:k})};g.prototype.matches=function(j,i,h){return this.options.get("matcher")(j,i,h)};g.prototype.unselect=function(i){var h=this;if(!this.$element.prop("multiple")){return}i.selected=false;if(d(i.element).is("option")){i.element.selected=false;d(i.element).closest("select").find('option[value="'+i.id+'"]').prop("selected",false);this.$element.trigger("change");return}this.current(function(j){var l=[];for(var k=0;k<j.length;k++){var m=j[k].id;if(m!==i.id&&d.inArray(m,l)===-1){l.push(m)}}h.$element.val(l);h.$element.trigger("change")})};g.prototype.current=function(j){var i=[];var h=this;this.$element.find("option").each(function(){var l=d(this);if(this.selected){var k=h.item(l);if(!i.some(function(m){return m.id===k.id})){i.push(k)}}});j(i)}});d.fn.select2.amd.define("CustomBaseSelection",["jquery","select2/utils","select2/keys","select2/selection/base",],function(j,i,g,h){h.prototype.bind=function(k,n){var m=this;var o=k.id+"-container";var l=k.id+"-results";this.container=k;this.$selection.on("focus",function(p){m.trigger("focus",p)});this.$selection.on("blur",function(p){m._handleBlur(p)});this.$selection.on("keydown",function(p){m.trigger("keypress",p);if(p.which===g.SPACE){p.preventDefault()}});k.on("results:focus",function(p){m.$selection.attr("aria-activedescendant",p.data._resultId)});k.on("selection:update",function(p){m.update(p.data)});k.on("open",function(){m.$selection.attr("aria-expanded","true");m.$selection.attr("aria-owns",l);m._attachCloseHandler(k)});k.on("close",function(){m.$selection.attr("aria-expanded","false");m.$selection.removeAttr("aria-activedescendant");m.$selection.removeAttr("aria-owns");m.$selection.focus();window.setTimeout(function(){},0);m._detachCloseHandler(k)});k.on("enable",function(){m.$selection.attr("tabindex",m._tabindex)});k.on("disable",function(){m.$selection.attr("tabindex","-1")})}});d.fn.select2.amd.define("CustomSingleSelection",["jquery","select2/selection/base","select2/utils","select2/keys","select2/selection/single"],function(j,h,i,g,k){k.prototype.update=function(n){if(n.length===0){this.clear();return}var l=n[0];var o=this.$selection.find(".select2-selection__rendered");var m=this.display(l,o);o.empty().append(m);o.attr("title",m||l.title||l.text)}});d.fn.select2.amd.define("CustomMultipleSelection",["jquery","select2/selection/base","select2/utils","select2/selection/multiple"],function(j,g,i,h){h.prototype.update=function(o){this.clear();if(o.length===0){return}var l=[];for(var q=0;q<o.length;q++){var m=o[q];var k=this.selectionContainer();var n=this.display(m,k);k.append(n);k.attr("title",n||m.title||m.text);k.attr("data-id",m.id||"");i.StoreData(k[0],"data",m);l.push(k)}var p=this.$selection.find(".select2-selection__rendered");i.appendMany(p,l)}});function f(h){var g=h.data("preserved-order")||[],i=h.next(".select2-container"),k=i.find("li.select2-selection__choice"),j=k.last().next();if(typeof g!=="object"){g=[g]}g.forEach(function(m){var l=k.filter(function(o,n){return d(n).attr("data-id")===m});j.before(l)})}function a(g){return g&&Object.prototype.toString.call(g)==="[object Array]"}var c=100;d.fn.selectTwo=function(j,i){var m={useSelect2:false,data:[],allowClear:true,multiple:false,width:"153px",placeholder:"请选择",id:"id",matchField:["text"],resultFormat:"",selectedFormat:"",notMatched:false,labelPreventDefault:true,maxItemShow:c,maxSelectedItem:-1,minInputLength:-1,minInputText:"请至少输入%min%个字",noResultText:"没有匹配结果",searchingText:"查询中...",loadingMoreText:"加载中...",maxSelectedText:"只能选择%max%项",inModal:false,zIndex:29891016,ajax:null,group:false,groupTitleShow:true,groupEmptyTitleShow:true,change:function(o,p,n){},beforeBinding:function(n){return n}};var h={delay:250,url:"url",data:function(n){return{k:n.term}},success:function(n,o){n=typeof n==="string"?JSON.parse(n):n;return{data:n}},processResults:function(n,o){return{results:n}}};var k={updateData:function(n,o){n.empty();n.html("<option />");o=e(o,n.data("select2").options.options);var p=n.data("select2").dataAdapter;p.addOptions(p.convertToOptions(o))},updateValue:function(n,o){n.val(o);if(!a(o)){n.trigger("change");return}n.data("preserved-order",o);if(typeof o==="object"&&o.forEach){o.forEach(function(q){var p=n.find("optgroup");if(p.length){var r=p.children('[value="'+q+'"]');r.detach();p.append(r)}else{var r=n.children('[value="'+q+'"]');r.detach();n.append(r)}})}n.trigger("change",true);f(n)},destroy:function(n,o){n.select2("destroy");n.off("select2:close select2:open select2:select select2:unselect change");o&&n.empty()},close:function(n,o){n.select2("close")},open:function(n,o){n.select2("open")}};if(typeof j==="string"){if(k[j]){this.each(function(){var n=d(this);if(!n.data("select2")){return}k[j](n,i)})}return this}else{i=j}if(i.useSelect2){this.select2(i);return this}this.css("width",i.width||m.width);if(i.ajax){var g=d.extend(true,{},m);g.ajax=h;var l=d.extend(true,{},g,i)}else{var l=d.extend(true,{},m,i)}l.minimumInputLength=l.minInputLength;l.maximumSelectionLength=l.maxSelectedItem;l.tags=l.notMatched;l.language={inputTooShort:function(n){if(n.minimum===1){return"请输入"}return l.minInputText.replace("%min%",n.minimum)},noResults:function(){return l.noResultText},searching:function(){return l.searchingText},loadingMore:function(){return l.loadingMoreText},maximumSelected:function(n){return l.maxSelectedText.replace("%max%",n.maximum)}};if(l.ajax){l.ajax.processResults=function(n,q){var p=l.ajax.success(n,q);var o=p.data;if(!l.group){l.data=o}else{l.group.forEach(function(r){r.data=o[r.groupKey]||[]})}l.data=e(l.group||l.data,l);p.results=l.data;return p}}else{l.data=e(l.group||l.data,l)}this.each(function(){b(d(this),l)});return this};function e(i,h){if(!h.group){h.idField=h.id;h.textField=h.matchField;i=d.map(i,function(j){j=h.beforeBinding(j);j.id=j.id||j[h.idField];var k=[];h.textField.forEach(function(l){j[l]&&k.push(j[l])});j.text=j.text||k.join("");return j});return i}else{var g=[];i.forEach(function(j){j.idField=j.id;j.textField=j.matchField;j.maxItemShow=j.maxItemShow||c;j.data=d.map(j.data,function(k){k=h.beforeBinding(k);k.matchField=j.matchField;k.resultFormat=j.resultFormat;j.selectedFormat=j.selectedFormat;k.id=k.id||k[j.idField];var l=[];j.textField.forEach(function(m){k[m]&&l.push(k[m])});k.text=k.text||l.join("");return k});if(j.data.length||h.groupEmptyTitleShow){g.push({id:j.id,text:j.title,children:j.data,maxItemShow:j.maxItemShow})}});return g}}function b(g,j){if(j.multiple){j.allowClear=false;g.find('option[value=""]').remove()}else{!g.find('option[value=""]').length&&g.prepend('<option value="" />')}var i=d.extend(true,{Results:d.fn.select2.amd.require("CustomResults"),SelectAdapter:d.fn.select2.amd.require("CustomSelectAdapter"),SingleSelection:d.fn.select2.amd.require("CustomSingleSelection"),MultipleSelection:d.fn.select2.amd.require("CustomMultipleSelection"),BaseSelection:d.fn.select2.amd.require("CustomBaseSelection"),matcher:function(r,p,l){if(d.trim(r.term)===""&&p.text){return{data:p}}if(typeof p.text==="undefined"||p.text===""||p.id===""||(i.group&&typeof p.children==="undefined")){return{data:null}}var o=r.term.toLowerCase();if(j.group){var n=[];p.children.forEach(function(q){q.matchField.forEach(function(s){if(q[s]&&q[s].toLowerCase().indexOf(o)!==-1){n.push(q);return false}})});if(n.length){var m=d.extend(true,{},p);m.children=n;return{data:m}}return{data:null}}var k=false;i.matchField.forEach(function(q){if(p[q]&&p[q].toLowerCase().indexOf(o)!==-1){k=true;return false}});if(k){return{data:d.extend(true,{},p)}}else{return{data:null}}},sorter:function(q){if(i.group){var p=d.extend(true,[],q);var o=d(".my-select").val()||[];o=typeof o==="string"?[o]:o;p.forEach(function(v){if(v["children"]){var s=v.maxItemShow;var w=v["children"].slice(0,s);var r=false;for(var u=s;u<v["children"].length;++u){for(var t=0;t<o.length;++t){if(v["children"][u][j.idField]===o[t]){r=true;w.push(v["children"][u])}}}r&&w.splice(s-o.length,o.length);v["children"]=w}});return p}var l=i.maxItemShow;var p=q.slice(0,l);var k=false;var o=g.val()||[];o=typeof o==="string"?[o]:o;for(var n=l;n<q.length;++n){for(var m=0;m<o.length;++m){if(q[n][j.idField]===o[m]){k=true;p.push(q[n])}}}k&&p.splice(l-o.length,o.length);return p},templateResult:function(n){var k=i.group?n.resultFormat:i.resultFormat;var o=k;if(!o||n.loading){return n.text}for(var l in n){if(n.hasOwnProperty(l)){var m=new RegExp("%"+l+"%","gi");o=o.replace(m,n[l])}}if(o===k&&i.tags){return n.text}return o},templateSelection:function(n){var k=i.group?n.resultFormat:i.resultFormat;var o=i.group?n.selectedFormat:i.selectedFormat;var p=o||k;if(!p||n.text===i.placeholder){return n.text}for(var l in n){if(n.hasOwnProperty(l)){var m=new RegExp("%"+l+"%","gi");p=p.replace(m,n[l])}}if(p===(o||k)&&i.tags){return n.text}return p}},j);g.select2(i).on("select2:close",function(l){var k=d(this).data("select2");k.$selection.removeClass("no-top no-bottom");if(i.inModal){k.$dropdown.css("z-index",1)}setTimeout(function(){k.$selection.find(".select2-search__field").focus()},0)}).on("select2:open",function(l){var k=d(this).data("select2");if(i.inModal){k.$dropdown.css("z-index",i.zIndex)}if(k.$dropdown.find(".select2-dropdown--above").length){k.$dropdown.addClass("no-margin-top");k.$selection.addClass("no-top").removeClass("no-bottom")}else{k.$dropdown.removeClass("no-margin-top");k.$selection.addClass("no-bottom").removeClass("no-top")}}).on("select2:select",function(m){if(i.ajax){var l=d(this);i.change(l,m.params.data,l.val())}else{if(a(d(this).val())){var n=m.params.data.id;var k=d(m.target).children('[value="'+n+'"]');k.detach();d(m.target).append(k).trigger("change",true)}}}).on("select2:unselect",function(m){if(i.ajax){var l=d(this);i.change(l,m.params.data,l.val())}else{if(a(d(this).val())){var n=m.params.data.id;var k=d(m.target).children('[value="'+n+'"]');k.detach();d(m.target).append(k).trigger("change",true)}}}).on("change",function(r,l){if(i.ajax||(a(d(this).val())&&!l)){return}var q=d(this),p=[],k={},n=[].concat(q.val());if(i.group){var o=[];for(var m=0;m<n.length;++m){if(o.indexOf(n[m])===-1){o.push(n[m])}}n=o;i.group.forEach(function(t){var s=[];t.data.forEach(function(u){if(n.indexOf(u.id)!==-1){s[n.indexOf(u.id)]=u;if(!i.multiple){return false}}});if(i.multiple){k[t.id]=s}else{k[t.id]=s[0]}});i.change(q,k,i.multiple?n:n[0]);return}i.data.forEach(function(s){if(n.indexOf(s.id)!==-1){p[n.indexOf(s.id)]=s;if(!i.multiple){return false}}});if(i.multiple){i.change(q,p,n)}else{i.change(q,p[0],n[0])}});if(i.labelPreventDefault){g.closest("label").on("click",function(k){k.preventDefault()})}var h=g.data("select2");if(i.group&&!i.groupTitleShow){h.$dropdown.addClass("select2-results__groupHide")}h.$selection.css("width",i.width)}})(jQuery);
