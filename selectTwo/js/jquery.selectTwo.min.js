(function(d){d.fn.select2.amd.define("CustomResults",["jquery","select2/utils","select2/results"],function(i,h,g){g.prototype.option=function(o){if(o.hidden){return null}var n,p=false;if(o.children){n=i('.select2-results__option[aria-label="'+o.text+'"]')[0];if(i(n).length===0){n=document.createElement("li");n.className="select2-results__option"}else{p=true}}else{n=document.createElement("li");n.className="select2-results__option"}var w={role:"treeitem","aria-selected":"false"};if(o.customClass){i(n).addClass("custom-class")}if(o.disabled){delete w["aria-selected"];w["aria-disabled"]="true"}if(o.id==null){delete w["aria-selected"]}if(o._resultId!=null){n.id=o._resultId}if(o.title){n.title=o.title}if(o.children){w.role="group";w["aria-label"]=o.text;delete w["aria-selected"]}for(var q in w){var m=w[q];n.setAttribute(q,m)}if(o.children){var j=i(n);var u=document.createElement("strong");u.className="select2-results__group";var t=i(u);this.template(o,u);var v=[];for(var s=0;s<o.children.length;s++){var l=o.children[s];var k=this.option(l);v.push(k)}var r;if(p){r=j.find(".select2-results__options--nested")}else{r=i("<ul></ul>",{"class":"select2-results__options select2-results__options--nested"})}r.append(v);if(!p){j.append(u);j.append(r)}}else{this.template(o,n)}i.data(n,"data",o);return n}});d.fn.select2.amd.define("CustomSelectAdapter",["select2/data/select"],function(g){g.prototype.query=function(i,h){var k=[],j=this;this.$element.children().each(function(){var l=d(this);if(l.is("option")||l.is("optgroup")){var n=j.item(l);var m=j.matches(i,n,k);null!==m.data&&k.push(m.data)}});h({results:k})};g.prototype.matches=function(j,i,h){return this.options.get("matcher")(j,i,h)};g.prototype.current=function(j){var i=[];var h=this;this.$element.find("option").each(function(){var l=d(this);if(this.selected){var k=h.item(l);i.push(k)}});j(i)}});d.fn.select2.amd.define("CustomMultipleSelection",["jquery","select2/selection/base","select2/utils","select2/selection/multiple"],function(j,g,i,h){h.prototype.update=function(o){this.clear();if(o.length===0){return}var l=[];for(var p=0;p<o.length;p++){var k=o[p];var n=this.selectionContainer();var m=this.display(k,n);n.append(m);n.attr("title",k.title||k.text);n.attr("data-id",k.id||"");i.StoreData(n[0],"data",k);l.push(n)}var q=this.$selection.find(".select2-selection__rendered");i.appendMany(q,l)}});function e(h){var g=h.data("preserved-order")||[],i=h.next(".select2-container"),k=i.find("li.select2-selection__choice"),j=k.last().next();if(typeof g!=="object"){g=[g]}g.forEach(function(m){var l=k.filter(function(o,n){return d(n).attr("data-id")===m});j.before(l)})}function b(g){return g&&Object.prototype.toString.call(g)==="[object Array]"}var a=100;d.fn.selectTwo=function(j,i){var m={useSelect2:false,data:[],allowClear:true,multiple:false,width:"153px",placeholder:"请选择",id:"id",matchField:["text"],resultFormat:"",selectedFormat:"",notMatched:false,labelPreventDefault:true,maxItemShow:a,maxSelectedItem:-1,minInputLength:-1,minInputText:"请至少输入%min%个字",noResultText:"没有匹配结果",searchingText:"查询中...",loadingMoreText:"加载中...",maxSelectedText:"只能选择%max%项",inModal:false,zIndex:29891016,ajax:null,group:false,groupTitleShow:true,groupEmptyTitleShow:true,change:function(n,p,o){},beforeBinding:function(n){return n}};var h={delay:250,url:"url",data:function(n){return{k:n.term}},success:function(n,o){n=typeof n==="string"?JSON.parse(n):n;return{data:n}},processResults:function(n,o){return{results:n}}};var k={updateData:function(n,o){n.empty();n.html("<option />");o=f(o,n.data("select2").options.options);var p=n.data("select2").dataAdapter;p.addOptions(p.convertToOptions(o))},updateValue:function(n,o){n.val(o);if(!b(o)){n.trigger("change");return}n.data("preserved-order",o);if(typeof o==="object"&&o.forEach){o.forEach(function(q){var p=n.find("optgroup");if(p.length){var r=p.children("[value="+q+"]");r.detach();p.append(r)}else{var r=n.children("[value="+q+"]");r.detach();n.append(r)}})}n.trigger("change",true);e(n)},destroy:function(n,o){n.select2("destroy");n.off("select2:close select2:open select2:select select2:unselect change");o&&n.empty()},close:function(n,o){n.select2("close")},open:function(n,o){n.select2("open")}};if(typeof j==="string"){if(k[j]){this.each(function(){var n=d(this);if(!n.data("select2")){return}k[j](n,i)})}return this}else{i=j}if(i.useSelect2){this.select2(i);return this}this.css("width",i.width||m.width);if(i.ajax){var g=d.extend(true,{},m);g.ajax=h;var l=d.extend(true,{},g,i)}else{var l=d.extend(true,{},m,i)}l.minimumInputLength=l.minInputLength;l.maximumSelectionLength=l.maxSelectedItem;l.tags=l.notMatched;l.language={inputTooShort:function(n){if(n.minimum===1){return"请输入"}return l.minInputText.replace("%min%",n.minimum)},noResults:function(){return l.noResultText},searching:function(){return l.searchingText},loadingMore:function(){return l.loadingMoreText},maximumSelected:function(n){return l.maxSelectedText.replace("%max%",n.maximum)}};if(l.ajax){l.ajax.processResults=function(n,q){var p=l.ajax.success(n,q);var o=p.data;if(!l.group){l.data=o}else{l.group.forEach(function(r){r.data=o[r.groupKey]||[]})}l.data=f(l.group||l.data,l);p.results=l.data;return p}}else{l.data=f(l.group||l.data,l)}this.each(function(){c(d(this),l)});return this};function f(i,g){if(!g.group){g.idField=g.id;g.textField=g.matchField;i=d.map(i,function(j){j=g.beforeBinding(j);j.id=j.id||j[g.idField];var k=[];g.textField.forEach(function(l){j[l]&&k.push(j[l])});j.text=j.text||k.join("");return j});return i}else{var h=[];i.forEach(function(j){j.idField=j.id;j.textField=j.matchField;j.maxItemShow=j.maxItemShow||a;j.data=d.map(j.data,function(k){k=g.beforeBinding(k);k.matchField=j.matchField;k.resultFormat=j.resultFormat;j.selectedFormat=j.selectedFormat;k.id=k.id||k[j.idField];var l=[];j.textField.forEach(function(m){k[m]&&l.push(k[m])});k.text=k.text||l.join("");return k});if(j.data.length||g.groupEmptyTitleShow){h.push({id:j.id,text:j.title,children:j.data,maxItemShow:j.maxItemShow})}});return h}}function c(h,g){if(g.multiple){g.allowClear=false;h.find('option[value=""]').remove()}else{!h.find('option[value=""]').length&&h.prepend('<option value="" />')}var j=d.extend(true,{Results:d.fn.select2.amd.require("CustomResults"),SelectAdapter:d.fn.select2.amd.require("CustomSelectAdapter"),MultipleSelection:d.fn.select2.amd.require("CustomMultipleSelection"),matcher:function(r,p,l){if(d.trim(r.term)===""&&p.text){return{data:p}}if(typeof p.text==="undefined"||p.text===""||p.id===""||(j.group&&typeof p.children==="undefined")){return{data:null}}var o=r.term.toLowerCase();if(g.group){var n=[];p.children.forEach(function(q){q.matchField.forEach(function(s){if(q[s]&&q[s].toLowerCase().indexOf(o)!==-1){n.push(q);return false}})});if(n.length){var m=d.extend(true,{},p);m.children=n;return{data:m}}return{data:null}}var k=false;j.matchField.forEach(function(q){if(p[q]&&p[q].toLowerCase().indexOf(o)!==-1){k=true;return false}});if(k){return{data:d.extend(true,{},p)}}else{return{data:null}}},sorter:function(q){if(j.group){var p=d.extend(true,[],q);var o=d(".my-select").val()||[];o=typeof o==="string"?[o]:o;p.forEach(function(v){if(v.children){var u=v.maxItemShow;var w=v.children.slice(0,u);var r=false;for(var t=u;t<v.children.length;++t){for(var s=0;s<o.length;++s){if(v.children[t][g.idField]===o[s]){r=true;w.push(v.children[t])}}}r&&w.splice(u-o.length,o.length);v.children=w}});return p}var n=j.maxItemShow;var p=q.slice(0,n);var k=false;var o=h.val()||[];o=typeof o==="string"?[o]:o;for(var m=n;m<q.length;++m){for(var l=0;l<o.length;++l){if(q[m][g.idField]===o[l]){k=true;p.push(q[m])}}}k&&p.splice(n-o.length,o.length);return p},templateResult:function(n){var m=j.group?n.resultFormat:j.resultFormat;var o=m;if(!o||n.loading){return n.text}for(var k in n){if(n.hasOwnProperty(k)){var l=new RegExp("%"+k+"%","gi");o=o.replace(l,n[k])}}if(o===m&&j.tags){return n.text}return o},templateSelection:function(n){var m=j.group?n.resultFormat:j.resultFormat;var o=j.group?n.selectedFormat:j.selectedFormat;var p=o||m;if(!p||n.text===j.placeholder){return n.text}for(var k in n){if(n.hasOwnProperty(k)){var l=new RegExp("%"+k+"%","gi");p=p.replace(l,n[k])}}if(p===(o||m)&&j.tags){return n.text}return p}},g);h.select2(j).on("select2:close",function(l){var k=d(this).data("select2");k.$selection.removeClass("no-top no-bottom");if(j.inModal){k.$dropdown.css("z-index",1)}setTimeout(function(){k.$selection.find(".select2-search__field").focus()},0)}).on("select2:open",function(l){var k=d(this).data("select2");if(j.inModal){k.$dropdown.css("z-index",j.zIndex)}if(k.$dropdown.find(".select2-dropdown--above").length){k.$dropdown.addClass("no-margin-top");k.$selection.addClass("no-top").removeClass("no-bottom")}else{k.$dropdown.removeClass("no-margin-top");k.$selection.addClass("no-bottom").removeClass("no-top")}}).on("select2:select",function(m){if(j.ajax){var l=d(this);j.change(l,m.params.data,l.val())}else{if(b(d(this).val())){var n=m.params.data.id;var k=d(m.target).children("[value="+n+"]");k.detach();d(m.target).append(k).trigger("change",true)}}}).on("select2:unselect",function(m){if(j.ajax){var l=d(this);j.change(l,m.params.data,l.val())}else{if(b(d(this).val())){var n=m.params.data.id;var k=d(m.target).children("[value="+n+"]");k.detach();d(m.target).append(k).trigger("change",true)}}}).on("change",function(q,m){if(j.ajax||(b(d(this).val())&&!m)){return}var k=d(this).data("select2");k.$container.find(".select2-selection__rendered, .select2-selection__choice").attr("title","");var p=d(this),o=[],l={},n=[].concat(p.val());if(j.group){j.group.forEach(function(s){var r=[];s.data.forEach(function(t){if(n.indexOf(t.id)!==-1){r[n.indexOf(t.id)]=t;if(!j.multiple){return false}}});if(j.multiple){l[s.id]=r}else{l[s.id]=r[0]}});j.change(p,l,j.multiple?n:n[0]);return}j.data.forEach(function(r){if(n.indexOf(r.id)!==-1){o[n.indexOf(r.id)]=r;if(!j.multiple){return false}}});if(j.multiple){j.change(p,o,n)}else{j.change(p,o[0],n[0])}});if(j.labelPreventDefault){h.closest("label").on("click",function(k){k.preventDefault()})}var i=h.data("select2");i.$container.find(".select2-selection__rendered, .select2-selection__choice").attr("title","");if(j.group&&!j.groupTitleShow){i.$dropdown.addClass("select2-results__groupHide")}i.$selection.css("width",j.width)}})(jQuery);
